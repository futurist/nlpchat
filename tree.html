<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script type="text/javascript" src="http://1111hui.com/js/mithril.js"></script>
<title></title>
</head>
<body>

</body>
</html>
<script type="text/javascript">
var data=[
{
	text:'root',
	class:'asdfas',
	_static:true,
	children:[
		['sdfijosd','oisdjf'],
		'osdfijoiasdjf',
		{
			text:'A',
			_close:true,
			children:[
				{
					text:'A1',
					font:'red',
					children:null
				},
				{
					text:'A2'
				},
			]
		},
		{
			text:'B'
		}
	]
}]

var type = {}.toString;
var OBJECT = type.call({});
// var ARRAY =  type.call([]);	// comment this to skip unused for eshint
var STRING = type.call('');

function _extend(src, dest){
	Object.keys(dest).filter(k=> k[0]!='_' || ['text','children'].indexOf(k)<0 ).forEach(k=> src[k]=dest[k] )
	return src
}
function interTree(arr){
	return !arr ? [] : {tag:'ul', attrs:{}, children:
		arr.map(v=>{
			v = type.call(v)==STRING ? {text:v} : v
			if( type.call(v)!=OBJECT ) return v;
			return {
				tag : 'li',
				attrs : _extend({
					onclick:function(e){
						e.stopPropagation()
						if(e.altKey) return v._edit = true;
						if(e.target.tagName.toUpperCase()=='INPUT') return;
						else if(v._edit) return v._edit = false;
						if(v._static) return;
						v._close = !v._close
					}
				}, v),
				children : [
					v.children? (v._close?'+':'-') :[],
					v._edit ? m('input', { value:v.text, oninput:m.withAttr('value', val=>{v.text=val}) } ) : v.text
				].concat( v._close ? [] : interTree(v.children) )
			}
		})
	}
}


var com={
	controller:function  () {

	},
	view:function(ctrl){
		return interTree(data)
	}
}

m.mount( document.body, com )


</script>
