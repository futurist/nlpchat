<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script type="text/javascript" src="http://1111hui.com/js/mithril.js"></script>
<title></title>
<style type="text/css">
.tree1 *{
	-webkit-user-select:none;
	user-select:none;
}
.tree1 li{
	cursor: default;
}
</style>
</head>
<body>

</body>
</html>
<script type="text/javascript">
var data=[
{
	text:'root',
	class:'asdfas',
	_static:true,
	children:[
		['sdfijosd','oisdjf'],
		'osdfijoiasdjf',
		{
			text:'A',
			_close:true,
			children:[
				{
					text:'A1',
					font:'red',
					children:null
				},
				{
					text:'A2'
				},
			]
		},
		{
			text:'B'
		}
	]
}]

var type = {}.toString;
var OBJECT = type.call({});
// var ARRAY =  type.call([]);	// comment this to skip unused for eshint
var STRING = type.call('');

function _extend(src, dest){
	Object.keys(dest).filter(k=> k[0]!='_' || ['text','children'].indexOf(k)<0 ).forEach(k=> src[k]=dest[k] )
	return src
}
function interTree(arr){
	return !arr ? [] : {tag:'ul', attrs:{}, children:
		arr.map( (v,idx)=>{
			v = type.call(v)==STRING ? {text:v} : v
			if( type.call(v)!=OBJECT ) return v;
			return {
				tag : 'li',
				attrs : _extend({
					onclick:function(e){
						e.stopPropagation()
						if(e.ctrlKey){
							e.preventDefault()
							if(e.altKey) v.children=v.children||[], v._close=false, v.children.splice(0,0,{text:'', _edit:true} )
							else arr.splice(idx,0,{text:'', _edit:true} )
							return
						}
						if(e.altKey) return arr.splice(idx,1);
						if(e.target.tagName.toUpperCase()=='INPUT') return;
						else if(v._edit) return v._edit = false;
						if(!v._static) v._close = !v._close;
					},
					ondblclick:function(e){
						e.stopPropagation()
						v._edit = true;
					}
				}, v),
				children : [
					v.children? (v._close?'+':'-') :[],
					v._edit ? m('input', {
						value:v.text,
						oninput:function(e){ v.text=this.value; }, 
						onkeydown:e=>{ if(e.keyCode==13)return v._edit=false; },
						config:el=>el.focus()
					} ) : v.text
				].concat( v._close ? [] : interTree(v.children) )
			}
		})
	}
}


var com={
	controller:function  () {

	},
	view:function(ctrl){
		return m('.tree1', interTree(data))
	}
}

m.mount( document.body, com )


</script>
